/*!
 * jQuery VGrid v0.1.9 - variable grid layout plugin
 *
 * Terms of Use - jQuery VGrid
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2009-2012 xlune.com All rights reserved.
 * (http://blog.xlune.com/2009/09/jqueryvgrid.html)
 */
(function(n){var e=function(n,t){return(n[0]>=t[0]&&n[0]<t[1]||n[1]>=t[0]&&n[1]<t[1])&&(n[0]>=t[0]&&n[0]<t[1]?n[0]=t[1]:n[1]=t[0]),n},o=function(n){var t=n.outerWidth(!0),i=n.outerHeight(!0);return[t,i]},s=function(n){var i=n.data("_vgchild").length*(n.data("_vgopt").delay||0)+n.data("_vgopt").time||500,t;n.stop(),t=n.data("_vgwrapheight"),n.height()<t?n.height(n.data("_vgwrapheight")):(clearTimeout(n.data("_vgwraptimeout")),n.data("_vgwraptimeout",setTimeout(function(){n.height(t)},i)))},h=function(t){t.each(function(){var i=n(this);n.support.transition?(i.css("x",i.data("_vgleft")+"px"),i.css("y",i.data("_vgtop")+"px")):(i.css("left",i.data("_vgleft")+"px"),i.css("top",i.data("_vgtop")+"px"))})},r=function(t,i,r,u){for(var s=t.parent(),h=!1,c=t.length,f,o,e=0;e<c;e++)f=n(t[e]),o=f.position(),(o.left!=f.data("_vgleft")||o.top!=f.data("_vgtop"))&&(h=!0);h&&(s.trigger("vgrid_start"),t.each(function(f){var e=n(this),o={duration:r,easing:i};t.size()-1===f&&(o.complete=function(){s.trigger("vgrid_finish")}),clearTimeout(e.data("_vgtimeout")),e.data("_vgtimeout",setTimeout(function(){n.support.transition?e.transition(n.extend({},o,{x:e.data("_vgleft")+"px",y:e.data("_vgtop")+"px"})):e.animate({left:e.data("_vgleft")+"px",top:e.data("_vgtop")+"px"},o)},f*u))}))},t=function(t){t.each(function(){var u=n(this);clearTimeout(u.data("_vgtimeout")),u.data("_vgtimeout",setTimeout(function(){i(u);var n=u.data("_vgopt"),t=n.easing||"linear",f=n.time||500,e=n.delay||0;r(u.data("_vgchild"),t,f,e)},500))})},i=function(t){var u=t.data("_vgchild"),f=t.width(),i=[[0,f,0]],r=0;u.each(function(){var f=n(this),e=o(f),u=c(i,e[0]);i=l(i,u,e),r=Math.max(r,u[1]+e[1]),f.data("_vgleft",u[0]),f.data("_vgtop",u[1])}),t.data("_vgwrapheight",r),s(t)},c=function(n,t){for(var n=n.concat().sort(u),r=n[n.length-1][2],i=0,f=n.length;i<f;i++){if(n[i][2]>=r)break;if(n[i][1]-n[i][0]>=t)return[n[i][0],n[i][2]]}return[0,r]},l=function(n,t,i){for(var n=n.concat().sort(u),f=[t[0],t[0]+i[0],t[1]+i[1]],r=0,o=n.length;r<o;r++)f[0]<=n[r][0]&&n[r][1]<=f[1]?delete n[r]:n[r]=e(n[r],f);return v(n,f)},u=function(n,t){return!n||!t?0:n[2]==t[2]&&n[0]>t[0]||n[2]>t[2]?1:-1},a=function(n,t){return!n||!t?0:n[0]>t[0]?1:-1},v=function(n,t){for(var n=n.concat([t]).sort(a),i=[],r=0,u=n.length;r<u;r++)n[r]&&(i.length>0&&i[i.length-1][1]==n[r][0]&&i[i.length-1][2]==n[r][2]?i[i.length-1][1]=n[r][1]:i.push(n[r]));return i},y=function(t,i){var r=n("<span />").text(" ").prop("id","_vgridspan").hide().appendTo("body");r.data("size",r.css("font-size")),r.data("timer",setInterval(function(){r.css("font-size")!=r.data("size")&&(r.data("size",r.css("font-size")),i(t))},1e3))},f=function(t,i){if(!t.data("vgrid-image-event-added")){t.data("vgrid-image-event-added",1);t.on("vgrid-added",function(){t.find("img").each(function(){var r=n(this);if(!r.data("vgrid-image-handler")){r.data("vgrid-image-handler",1);r.on("load",function(){i(t)})}})})}t.triggerHandler("vgrid-added");var r=t.append,u=t.prepend;t.append=function(){r.apply(t,arguments),t.triggerHandler("vgrid-added")},t.prepend=function(){u.apply(t,arguments),t.triggerHandler("vgrid-added")}};n.fn.extend({vgrid:function(r){var u=n(this);return u.each(function(){var e=n.extend({time:500,delay:0,easing:"linear",autoResize:!0},r),u=n(this),o=u.find("> *"),s;u.data("_vgopt",e),u.data("_vgchild",o),u.data("_vgdefchild",o),u.css({position:"relative"}),o.css("position","absolute"),i(u),h(o),e.fadeIn?(s=function(){return typeof e.fadeIn=="object"?e.fadeIn:{time:e.fadeIn}}(),o.each(function(t){var i=n(this);i.css({opacity:0}).show().stop(),setTimeout(function(){n.support.transition?i.show().transition({opacity:1},s.time||250):i.stop().fadeTo(s.time||250,1)},t*(s.delay||0))})):o.show(),n(window).resize(function(){e.autoResize===!0&&t(u)}),e.useLoadImageEvent&&f(u,t),e.useFontSizeListener&&y(u,t),u.triggerHandler("vgrid_init")}),u},vgrefresh:function(u,e,o,s){var h=n(this);return h.each(function(){var h=n(this),l=h.data("_vgopt")||{},c;h.data("_vgchild")&&(c=h.find("> *"),h.data("_vgchild",c),c.css("position","absolute"),i(h),e=typeof e=="number"?e:l.time,o=typeof o=="number"?o:l.delay,u=u||l.easing,r(c,u,e,o),typeof s=="function"&&setTimeout(s,c.length*o+e)),l.useLoadImageEvent&&f(h,t)}),h},vgsort:function(t,u,f,e){var o=n(this);return o.each(function(){var o=n(this),s,h;o.data("_vgchild")&&(s=o.data("_vgopt")||{},h=o.data("_vgchild"),o.data("_vgchild",h.sort(t)),h.each(function(){n(this).appendTo(o)}),i(o),u=u||s.easing,f=typeof f=="number"?f:s.time,e=typeof e=="number"?e:s.delay,r(h,u,f,e))}),o},vgheight:function(){var t=n(this);return t.data("_vgwrapheight")},vgoption:function(){var t={},i;n.isPlainObject(arguments[0])?t=arguments[0]:t[arguments[0]]=arguments[1],i=n(this),i.each(function(){var r=n(this),i=r.data("_vgopt");i!=null&&(i=n.extend(i,t),r.data("_vgopt",i))})}})})(jQuery)